{% extends 'base.html' %}

{% block content %}
<script src="https://d3js.org/d3.v4.min.js"></script>
<div class="profileContainer"></div>

    <div class="col-md-5 mx-auto" >
        <button onclick="goBack()">Back</button>
        <!-- Profile widget -->
        <div class="bg-white shadow rounded overflow-hidden" >
            <div class="px-4 pt-0 pb-4 cover">
                <div class="media align-items-end profile-head">
                    <div class="profile mr-3"><img src="{{ userInformation.0 }}" alt="..." width="130" class="rounded mb-2 img-thumbnail"></div>
                    <div class="media-body mb-5 text-black">
                        <h4 class="mt-0 mb-0">{{ userInformation.1 }}</h4>
                    </div>
                </div>
                
            </div>
            <div class="bg-light p-4 d-flex justify-content text-center">
                <h4 class="mt-0 mb-0">Reputation: {{ userInformation.2 }}</h4>
            </div>
            <div class="px-4 py-3">
                <div class="p-4 rounded shadow-sm bg-light">
                    <svg width="500" height="500"></svg>
                </div>
                <div class="p-4 rounded shadow-sm bg-light">
                    <svg id = "abc" width="500" height="500"></svg>
                </div>
            </div>
    </div>
</div>

</div>

<style>

    .profileContainer{
        margin-top: 5%;
        
    }

    


    .px-4.py-3{
        text-align: center;
        display: flex;
        
    }


    .px-4.pt-0.pb-4.cover{
        text-align: center;
    }

    .col-md-5.mx-auto{
        width: 1140px;
    }
    
</style>

<script>

    function goBack() {
        window.history.back();
      }

    

    var svg = d3.select("svg"),
        margin = 200,
        width = svg.attr("width") - margin,
        height = svg.attr("height") - margin

    svg.append("text")
       .attr("transform", "translate(100,0)")
       .attr("x", 50)
       .attr("y", 50)
       .attr("font-size", "24px")
       .text("User Badge Counts")

    var xScale = d3.scaleBand().range([0, width]).padding(0.4),
        yScale = d3.scaleLinear().range([height, 0]);

    var g = svg.append("g")
               .attr("transform", "translate(" + 100 + "," + 100 + ")");

        data = [{
            badge: "Bronze",
            count: "{{ userInformation.6 }}"
        },
        {
            badge: "Silver",
            count: "{{ userInformation.7 }}"
        },
        {
            badge: "Gold",
            count: "{{ userInformation.8 }}"
        },
        ]
        var color = ["#CD7F32", "#C0C0C0", "#FFD700"]
        

        xScale.domain(data.map(function(d) { return d.badge; }));
        yScale.domain([0, d3.max(data, function(d) { return +d.count; })]);

        //X AXIS
        g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(xScale))
         .append("text")
         .attr("y", height - 250)
         .attr("x", width - 200)
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Badge Type");


        // YAXIS
        g.append("g")
         .call(d3.axisLeft(yScale).tickFormat(function(d){
             return  d;
         })
         .ticks(10))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", 6)
         .attr("dy", "-5.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Badge Count");

        g.selectAll(".bar")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar")
         .attr("x", function(d) { return xScale(d.badge); })
         .attr("y", function(d) { return yScale(d.count); })
         .attr("width", xScale.bandwidth())
         .attr("height", function(d) { return height - yScale(d.count); })
         .attr("fill", function(d, i) {
            return color[i%3] // here it is picking up colors in sequence
          })
          .on("mouseover", function(d, i) {
            tooltip.html(`Badge Count: ${d.count}`).style("visibility", "visible");
          })
          .on("mousemove", function(){
            tooltip
              .style("top", (event.pageY-10)+"px")
              .style("left",(event.pageX+10)+"px");
          })
          .on("mouseout", function() {
            tooltip.html(``).style("visibility", "hidden");   });;



/////////////////////////////////////////////////////////////
///////////////////////// Graph 2 //////////////////////////
///////////////////////////////////////////////////////////

    var svg2 = d3.select("#abc"),
    margin = 200,
    width = svg2.attr("width") - margin,
    height = svg2.attr("height") - margin

    svg2.append("text")
       .attr("transform", "translate(100,0)")
       .attr("x", 50)
       .attr("y", 50)
       .attr("font-size", "24px")
       .text("Tag Answer Info")

    var xScale = d3.scaleBand().range([0, width]).padding(0.4),
        yScale = d3.scaleLinear().range([height, 0]);

    var g = svg2.append("g")
               .attr("transform", "translate(" + 100 + "," + 100 + ")");

        data = [{
            stat: "Answer Count",
            value: "{{ userInformation.5 }}"
        },
        {
            stat: "Answer Score",
            value: "{{ userInformation.4 }}"
        }

        ]
        var color2 = ["Blue", "Green"]
        

        xScale.domain(data.map(function(d) { return d.stat; }));
        yScale.domain([0, d3.max(data, function(d) { return +d.value; })]);

        const tooltip = d3.select("body")
        .append("div")
        .attr("class","d3-tooltip")
        .style("position", "absolute")
        .style("z-index", "10")
        .style("visibility", "hidden")
        .style("padding", "15px")
        .style("background", "rgba(0,0,0,0.6)")
        .style("border-radius", "5px")
        .style("color", "#fff")
        .text("a simple tooltip");
        

        //X AXIS
        g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(xScale))
         .append("text")
         .attr("y", height - 250)
         .attr("x", width - 200)
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         


        // YAXIS
        g.append("g")
         .call(d3.axisLeft(yScale).tickFormat(function(d){
             return  d;
         })
         .ticks(10))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", 6)
         .attr("dy", "-5.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Scores");

         // Bar 

        g.selectAll(".bar")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar")
         .attr("x", function(d) { return xScale(d.stat); })
         .attr("y", function(d) { return yScale(d.value); })
         .attr("width", xScale.bandwidth())
         .attr("height", function(d) { return height - yScale(d.value); })
         .attr("fill", function(d, i) {
            return color2[i%2] // here it is picking up colors in sequence
          })
                  .on("mouseover", function(d, i) {
          tooltip.html(`Value: ${d.value}`).style("visibility", "visible");
        })
        .on("mousemove", function(){
          tooltip
            .style("top", (event.pageY-10)+"px")
            .style("left",(event.pageX+10)+"px");
        })
        .on("mouseout", function() {
          tooltip.html(``).style("visibility", "hidden");   });
          
 
</script>
{% endblock %}
